<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>안똔 체홉 극장</title>
    <style>
        body {
            width: 100vw;
            height: 100vh;
        }

        h1 {
            text-align: center;
            color: royalblue;
        }

        #accessBtn {
            margin: 0 auto;
            cursor: pointer;
            background-color: royalblue;
            color: white;
            text-align: center;
            width: 20vw;
            font-size: 1.5vw;
            border-radius: 30px;
            text-decoration: underline;
            height: 5vh;
            padding-top: calc((5vh - 1.5vw) / 2 + 0.1vw);
        }

        #accessBtn:hover {
            background-color: white;
            color: royalblue;
            font-weight: 900;
        }

        .seatsRow {
            display: flex;
            margin: 0 auto;
            justify-content: center;
            opacity: 0;
        }

        .seatsColumn {
            border-radius: 10px;
            width: 3vw;
            height: 3vw;
            margin: 0.5vw;
            cursor: pointer;
        }

        .enable {
            background-color: skyblue;
        }

        .enable:hover {
            margin: 0;
            width: 4vw;
            height: 4vw;
        }

        .disable {
            background-color: gray;
        }
    </style>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
</head>

<body>
    <h1>♥ 안똔 체홉 극장 좌석 예매 ♥</h1>
    <div id="accessBtn">예매 페이지로 이동하기</div>
</body>
<script>
    const transitionSecond = 0.5;
    $("#accessBtn").css("transition", `${transitionSecond}s`);

    $(window).ready(() => {

        // ㅜ 예매 페이지로 이동하는 버튼을 클릭했을 때
        $("#accessBtn").on("click", function () {
            $(this).css("opacity", "0");

            // ㅜ 트랜지션이 종료되었을 때
            setTimeout(() => {
                $(this).css("display", "none");

                const socket = io.connect();

                // ㅜ 좌석 데이터를 불러오는 주소에 접근하기
                $.getJSON("/show_all_seats",

                    // ㅜ 요청하는 주소가 동일할 경우에 이전 값을 가져오는 혹시 모를 경우를 방지하기 위해 추가 데이터로 현재 시간을 전달하기
                    { dummy: new Date().getTime() }, (seats) => {

                        // ㅜ 배열의 행만큼 태그 생성하기
                        $.each(seats, (rowIdx, rowElement) => {
                            const $rowElement = $("<div></div>").addClass("seatsRow");
                            $rowElement.css("transition", `${transitionSecond}s`);

                            // ㅜ 배열의 열만큼 태그 생성하기
                            $.each(rowElement, (columnIdx, columnElement) => {
                                const $columnElement = $("<div></div>", {
                                    class: "seatsColumn",
                                    "data-row": rowIdx,
                                    "data-column": columnIdx
                                }).appendTo($rowElement);

                                $rowElement.insertAfter($("#accessBtn"));
                                setTimeout(() => {
                                    $rowElement.css("opacity", "1");
                                    if (columnElement === 1) $columnElement.addClass("enable");
                                    else $columnElement.addClass("disable");
                                }, transitionSecond*10);
                            })
                        })
                });
            }, transitionSecond);
        })
    })

    // ㅜ getJSON 동기로 변경하기
    $.ajaxSetup({
        async: false
    })
</script>

</html>